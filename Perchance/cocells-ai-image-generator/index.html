<!DOCTYPE html>

<head>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="../assets/styles.css" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="page-load bg-foreground pos-fixed full-overlay" id="page-load-id">
    <div class="page-load-shadow pos-absolute full-overlay"></div>
    <div class="pos-absolute">
      <div class="page-wrapper">
        <h1 class="zen-title zen-sp">[$meta.title]</h1>
        <div class="page-load-indication">
          <div class="page-load-indication-bar pos-absolute"></div>
        </div>
        <div class="page-load-text">Please wait, the page is loading.</div>
      </div>
    </div>
  </div>
  <div id="main-body-id" class="main-body no-size-tran">
    <header id="header-id">
      <div class="main-header zen-ui">
        <button class="side-drawer-header" onclick="sideMenuDrawer()">
          <span class="material-symbols-rounded" style="margin-top: 4px;">
            menu
          </span>
        </button>
        <button onclick="$Fullscreen()">
          <span class="material-symbols-rounded open-fullscreen">
            fit_screen
          </span>
          <span class="material-symbols-rounded close-fullscreen">
            fullscreen_exit
          </span>
        </button>
        <button class="darkmode-button" onclick="darkmode()">
          <span class="material-symbols-rounded light-mode"> light_mode </span>
          <span class="material-symbols-rounded dark-mode"> dark_mode </span>
        </button>
      </div>
    </header>
    <main>
      <div class="main-wint-body over-hidden">
        <nav class="side-menu-container">
          <div class="side-menu">
            <div class="side-menu-wrapper">
              <div class="side-menu-wrapper-wrapper">
                <section id="tabsContainer">
                  <button class="tabs" name="aimg">
                    <div class="tabs-icon">
                      <span class="material-symbols-rounded"> image </span>
                    </div>
                    <div class="tabs-text" ser>AI Image</div>
                    <div class="tabs-shadow-wrapper">
                      <div class="tabs-shadow"></div>
                    </div>
                  </button>

                  <button class="tabs" name="chat">
                    <div class="tabs-icon">
                      <span class="material-symbols-rounded"> chat </span>
                    </div>
                    <div class="tabs-text" ser>Chat</div>
                    <div class="tabs-shadow-wrapper">
                      <div class="tabs-shadow"></div>
                    </div>
                  </button>

                  <button class="tabs" name="gallery">
                    <div class="tabs-icon">
                      <span class="material-symbols-rounded">
                        gallery_thumbnail
                      </span>
                    </div>
                    <div class="tabs-text" ser>Gallery</div>
                    <div class="tabs-shadow-wrapper">
                      <div class="tabs-shadow"></div>
                    </div>
                  </button>
                </section>
              </div>
            </div>
          </div>
          <div class="side-menu-drawer">
            <div class="side-menu-container-button">
              <button id="menu-drawer" onclick="sideMenuDrawer()">
                <span class="material-symbols-rounded arrow">
                  arrow_back_ios_new
                </span>
                <span class="material-symbols-rounded close"> close </span>
              </button>
            </div>
          </div>
        </nav>
        <div class="window-panel bg-foreground d-round1">
          <div class="tab-window" name="aimg" id="aimg">
            <div class="aimg-container">
              <div class="aimg-output-container no-scroll-from-mid">
                <div style="height: 100%;" class="no-scroll-from-mid flexC">
                  <div id="aimg-output">
                    <style>
                      .x-3-e-f-2 * {
                        text-align: center;
                        color: var(--text-lighter);
                      }

                      .x-3-e-f-2 span {
                        color: hsl(0deg 100% 60%);
                        font-weight: bold;
                      }
                    </style>
                    <div class="x-3-e-f-2">
                      <div>Write your prompt and start generating.</div>
                      <div>
                        Please be descriptive to avoid generating
                        <span>distored</span> images.
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="aimg-output-overlay" onclick="aimgToggle()"></div>
              <div class="aimg">
                <div class="aimg-prompt-pre-wrapper">
                  <div class="aimg-prompt-wrapper">
                    <div class="aimg-prompt-extra">
                      <div class="aimg-extra-wrapper hover-scroll">
                        <div class="aimg-extra-wrapper-wrapper flexC">
                          <!-- Start >>> -->
                          <div class="aimg-extra-opt-card" aria-label="Negative prompt">
                            <div class="aimg-extra-opt-label">
                              Negative Prompt
                            </div>
                            <div class="aimg-extra-opts">
                              <input class="aimg-save-data" id="aimg-negative-prompt" type="text" />
                            </div>
                          </div>

                          <div class="aimg-extra-opt-card" aria-label="Image amount">
                            <div class="aimg-extra-opt-label">Image Amount</div>
                            <div class="aimg-extra-opts">
                              <input id="aimg-amount" type="number" min="1" max="26" value="4" />
                            </div>
                          </div>

                          <div class="aimg-extra-opt-card" aria-label="Image styles">
                            <div class="aimg-extra-opt-label">Styles</div>
                            <div class="aimg-extra-opts">
                              <select id="aimg-styles" class="aimg-save-data">
                                <option value="painted_anime">
                                  Painted Anime
                                </option>
                                <option value="soft_anime">Soft Anime</option>
                                <option value="cute_anime">Cute Anime</option>
                                <option value="no_style">ðŸ”´ No Style</option>
                                <option value="studio_ghibli">
                                  Studio Ghibli
                                </option>
                                <option value="manga">Manga</option>
                                <option value="neon_vintage_anime">
                                  Neon Vintage Anime
                                </option>
                                <option value="concept_art">Concept Art</option>
                                <option value="anime_pixel_art">
                                  Anime Pixel Art
                                </option>
                                <option value="game_style">Game Style</option>
                                <option value="digital_art">Digital Art</option>
                              </select>
                            </div>
                          </div>

                          <div class="aimg-extra-opt-card" aria-label="Image Size">
                            <div class="aimg-extra-opt-label">Size</div>
                            <div class="aimg-extra-opts">
                              <select id="aimg-size" class="aimg-save-data">
                                <option value="portrait">Portrait</option>
                                <option value="landscape">Landscape</option>
                                <option value="square">Square</option>
                              </select>
                            </div>
                          </div>

                          <div class="aimg-extra-opt-card" aria-label="Image Author">
                            <div class="aimg-extra-opt-label">
                              Author's name
                            </div>
                            <div class="aimg-extra-opts">
                              <input class="aimg-save-data" id="authors-name" type="text"
                                placeholder="You should write your name if you plan to share it in the gallery." />
                            </div>
                          </div>

                          <div class="aimg-extra-opt-card">
                            <div class="aimg-extra-opt-label">Notepad</div>
                            <div class="aimg-extra-opts">
                              <textarea style="resize: vertical;" class="aimg-save-data" name="notepad" id="te"
                                cols="30" rows="10"
                                placeholder="A little notepad for you to save some text if you need."></textarea>
                            </div>
                          </div>
                          <!-- Start <<< -->
                        </div>
                      </div>

                      <div style="padding: var(--def-value);" class="flexC">
                        <button class="aimg-toggle-bg-quick aimg-close-extra" onclick="aimgToggle()"
                          style="padding: 0; overflow: hidden;">
                          <div style="padding: var(--def-value);">Close</div>
                          <div class="shine-pre-container">
                            <div class="shine-en-container">
                              <div class="shine-object-bg">
                                <div class="shine-object-fg"></div>
                              </div>
                            </div>
                          </div>
                        </button>
                        <div class="aimg-extra-hr"></div>
                      </div>
                    </div>
                    <div class="aimg-prompt">
                      <div class="aimg-textarea-wrapper">
                        <div class="aimg-prompt-overlay pos-absolute full-overlay aimg-toggle-bg-quick"
                          onclick="aimgToggle()">
                          <div class="shine-pre-container" style="--shine-top: -50px;">
                            <div class="shine-en-container">
                              <div class="shine-object-bg">
                                <div class="shine-object-fg"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <textarea class="aimg-save-data" name="aimg-textarea" id="aimg-textarea-id"
                          placeholder="Type a prompt."></textarea>
                      </div>
                      <div class="aimg-button-wrapper">
                        <button class="bt-mat-icon-anim mat-icon-anim-zoom" id="aimg-generate-button"
                          style="transition-delay: 0s;" onclick="createAimg(); aimgStateApply('running')">
                          <span class="material-symbols-rounded mat-1">
                            draw
                          </span>
                          <span class="material-symbols-rounded mat-2">
                            add
                          </span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-window" style="overflow: hidden;" name="chat">
            [chat(chatOne)]
          </div>
          <div class="tab-window" style="overflow: hidden;" name="gallery">
            [image(gallery)]
          </div>
        </div>
      </div>
    </main>
    <div class="backdrop" style="top: 0; left: 0;" onclick="sideMenuDrawer()"></div>
  </div>

  <script>
    function sideMenuDrawer() {
      var sideMenuContainer = document.getElementById("main-body-id");

      if (sideMenuContainer.classList.contains("side-menu-collapse")) {
        sideMenuContainer.classList.remove("side-menu-collapse");
      } else {
        sideMenuContainer.classList.add("side-menu-collapse");
      }
    }

    var tabs = document.querySelectorAll("#tabsContainer .tabs");
    var sideMenuButtons = document.getElementsByClassName(
      "side-menu-container-button"
    );

    // Function to check if the side menu collapse should be removed
    function checkScreenWidthAndCollapse() {
      var screenWidth = window.innerWidth;
      var mainBody = document.getElementById("main-body-id");

      if (
        screenWidth <= 800 &&
        mainBody.classList.contains("side-menu-collapse")
      ) {
        mainBody.classList.remove("side-menu-collapse");
      }
    }

    // Add event listener to tabs
    tabs.forEach(function (tab) {
      tab.addEventListener("click", checkScreenWidthAndCollapse);
    });

    // Loop through sideMenuButtons and add event listener
    for (var i = 0; i < sideMenuButtons.length; i++) {
      sideMenuButtons[i].addEventListener("click", checkScreenWidthAndCollapse);
    }

    // Add event listener to side menu drawer
    var sideMenuDrawerBtn = document.querySelector(".side-menu-drawer");
    sideMenuDrawerBtn.addEventListener("click", function () {
      var screenWidth = window.innerWidth;
      var mainBody = document.getElementById("main-body-id");

      if (
        screenWidth <= 800 &&
        mainBody.classList.contains("side-menu-collapse")
      ) {
        mainBody.classList.remove("side-menu-collapse");
      }
    });

    function checkPageLoad() {
      // Check if there is a 'sealed' attribute in sessionStorage
      if (sessionStorage.getItem("sealed")) {
        applySealed();
      } else {
        // Check if all resources are loaded
        if (document.readyState === "complete") {
          setTimeout(() => {
            addClosedAttribute();
            saveToSessionStorage();
            setTimeout(() => {
              applySealed();
            }, 300);
          }, 1500);
        } else {
          // If resources are not loaded, wait for them to load
          setTimeout(checkPageLoad, 100);
        }
      }
    }

    function addClosedAttribute() {
      const pageLoadElement = document.getElementById("page-load-id");
      if (pageLoadElement) {
        pageLoadElement.setAttribute("closed", "");
      }
    }

    function applySealed() {
      const pageLoadElement = document.getElementById("page-load-id");
      if (pageLoadElement) {
        pageLoadElement.setAttribute("sealed", "");
      }
    }

    function saveToSessionStorage() {
      sessionStorage.setItem("sealed", "true");
    }

    checkPageLoad();
  </script>
  <script>
    // # Aimg scripts
    function aimgToggle() {
      var element = document.getElementById("aimg");
      if (element.classList.contains("aimg-toggle")) {
        element.classList.remove("aimg-toggle");
      } else {
        element.classList.add("aimg-toggle");
      }
    }

    window.addEventListener("load", function () {
      // Iterate through each element with the class 'aimg-save-data'
      document.querySelectorAll(".aimg-save-data").forEach(function (element) {
        // Get the ID of the current element
        var elementId = element.id;

        // Check if there is a value stored in local storage for this element
        var storedValue = localStorage.getItem(elementId);

        // If a value is found in local storage, set the value of the element
        if (storedValue !== null) {
          element.value = storedValue;
        } else {
          // If not found, save the current value of the element to local storage
          localStorage.setItem(elementId, element.value);
        }

        // Add event listener to listen for changes in the element's value
        element.addEventListener("input", function () {
          // Update local storage with the new value
          localStorage.setItem(elementId, element.value);
        });
      });
    });

    function aimgStateApply(state) {
      // Format the state parameter
      var formattedState = "aimg-state-" + state;

      // Get the element with the ID 'aimg'
      var aimgElement = document.getElementById("aimg");

      // Check if the element exists
      if (aimgElement) {
        // Add the formatted state as a custom attribute to the element
        aimgElement.setAttribute(formattedState, "");
      } else {
        console.error("Element with ID 'aimg' not found.");
      }
    }

    function removeAimgStates() {
      // Get the element with the ID 'aimg'
      var aimgElement = document.getElementById("aimg");

      // Check if the element exists
      if (aimgElement) {
        // Get all attributes of the element
        var attributes = aimgElement.attributes;

        // Loop through the attributes
        for (var i = 0; i < attributes.length; i++) {
          // Check if the attribute name starts with 'aimg-state-'
          if (attributes[i].name.startsWith("aimg-state-")) {
            // Remove the attribute
            aimgElement.removeAttribute(attributes[i].name);
            // Decrement the loop index to account for removed attribute
            i--;
          }
        }
      } else {
        console.error("Element with ID 'aimg' not found.");
      }
    }

    function aimgStateRemove(state) {
      // Format the state parameter
      var formattedState = "aimg-state-" + state;

      // Get the element with the ID 'aimg'
      var aimgElement = document.getElementById("aimg");

      // Check if the element exists
      if (aimgElement) {
        // Check if the attribute exists
        if (aimgElement.hasAttribute(formattedState)) {
          // Remove the attribute
          aimgElement.removeAttribute(formattedState);
        } else {
          console.warn(
            "Attribute '" +
            formattedState +
            "' not found on element with ID 'aimg'."
          );
        }
      } else {
        console.error("Element with ID 'aimg' not found.");
      }
    }

    document.addEventListener("load", function () {
      const textArea = document.getElementById("aimg-textarea-id");
      const generateButton = document.getElementById("aimg-generate-button");

      if (textArea && generateButton) {
        if (textArea.value.trim() === "") {
          generateButton.disabled = true;
        } else {
          generateButton.disabled = false;
        }

        // Add event listener for text changes (optional)
        textArea.addEventListener("input", function () {
          if (textArea.value.trim() === "") {
            generateButton.disabled = true;
          } else {
            generateButton.disabled = false;
          }
        });
      } else {
        // Handle the case where elements are not found (optional)
        console.error("Textarea or button element not found");
      }
    });

    // Get the element with id "aimg-amount"
    const aimgAmountInput = document.getElementById("aimg-amount");

    // Add event listener for the blur event
    aimgAmountInput.addEventListener("blur", function () {
      // Retrieve the min and max values
      const minValue = parseFloat(aimgAmountInput.min);
      const maxValue = parseFloat(aimgAmountInput.max);

      // Retrieve the current value
      let currentValue = parseFloat(aimgAmountInput.value);

      // Check if the current value is blank or undefined, set to 4
      if (!currentValue && currentValue !== 0) {
        currentValue = 4;
        console.log("Value is blank or undefined. Setting to 4.");
        // Set the new value
        aimgAmountInput.value = currentValue;
        return; // Exit the function after setting the value
      }

      // Log the current value before any modifications
      console.log("Before:", currentValue);

      // Check if the current value is within the range
      if (currentValue >= minValue && currentValue <= maxValue) {
        console.log("Value is within the range.");
        return; // Skip further execution
      }

      // If the current value is below the range, set it to the minimum
      if (currentValue < minValue) {
        console.log("Value is below the minimum. Setting to minimum.");
        currentValue = minValue;
      }
      // If the current value is above the range, set it to the maximum
      else if (currentValue > maxValue) {
        console.log("Value is above the maximum. Setting to maximum.");
        currentValue = maxValue;
      }

      // Log the reason for setting the value and the value after modification
      console.log("After:", currentValue);

      // Set the new value
      aimgAmountInput.value = currentValue;
    });

    // ***

    // ***

    // Get the value of the input with id="aimg-amount"
    function createAimg() {
      // Function to generate a random 9-character ID
      function generateRandomId() {
        const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let id = "";
        for (let i = 0; i < 9; i++) {
          id += characters.charAt(
            Math.floor(Math.random() * characters.length)
          );
        }
        return id;
      }

      // Get the value of the input with id="aimg-amount"
      const aimg_amount = document.getElementById("aimg-amount").value;
      let aimg_output = document.getElementById("aimg-output");

      // Clear the previous content of aimg_output
      aimg_output.innerHTML = "";

      // Loop to create and append aimg blocks
      for (let i = 0; i < aimg_amount; i++) {
        // Generate random ID
        const randomId = generateRandomId();

        // Create aimg block using template literals
        const aimg_block = `<div class="aimg-output-block" id="${randomId}">[output]</div>`;

        // Append aimg block to "aimg-output"
        aimg_output.innerHTML += aimg_block.evaluateItem;
        // console.log(`Aimg appended > ${randomId}.`);

        // Call update function if it exists
        if (typeof update === "function") {
          update(randomId);
          console.log(`Updated ID: ${randomId}`);
        } else {
          console.error(
            `Failed to update ID: ${randomId}. 'update' function is not defined.`
          );
        }
      }
    }

    // Check if the textarea element exists
    var textarea = document.getElementById("aimg-textarea-id");
    if (textarea) {
      // Add event listener to the textarea for input events
      textarea.addEventListener("input", function () {
        try {
          // Replace aiImagePrompt's value with the textarea's value
          aiImagePrompt =
            textarea.value.trim() !== ""
              ? textarea.value.trim()
              : initialAiImagePrompt;
        } catch (error) {
          // Handle errors
          console.error(
            "An error occurred while updating aiImagePrompt:",
            error.message
          );
        }
      });
    } else {
      console.error('Textarea element with id "aimg-textarea-id" not found.');
    }
    // Fullscreen Script
    function $Fullscreen() {
      console.log("Entering $Fullscreen function...");

      // Check if fullscreen mode is currently active
      var isInFullScreen =
        (document.fullscreenElement && document.fullscreenElement !== null) ||
        (document.webkitFullscreenElement &&
          document.webkitFullscreenElement !== null) ||
        (document.mozFullScreenElement &&
          document.mozFullScreenElement !== null) ||
        (document.msFullscreenElement && document.msFullscreenElement !== null);

      console.log("isInFullScreen: ", isInFullScreen);

      // If not in fullscreen, request fullscreen
      if (!isInFullScreen) {
        console.log("Requesting fullscreen...");

        var element = document.documentElement;
        if (element.requestFullscreen) {
          console.log("Requesting fullscreen using requestFullscreen...");
          element.requestFullscreen();
        } else if (element.mozRequestFullScreen) {
          /* Firefox */
          console.log("Requesting fullscreen using mozRequestFullScreen...");
          element.mozRequestFullScreen();
        } else if (element.webkitRequestFullscreen) {
          /* Chrome, Safari & Opera */
          console.log("Requesting fullscreen using webkitRequestFullscreen...");
          element.webkitRequestFullscreen();
        } else if (element.msRequestFullscreen) {
          /* IE/Edge */
          console.log("Requesting fullscreen using msRequestFullscreen...");
          element.msRequestFullscreen();
        }

        // Add the 'in-fullscreen' class to the body
        console.log("Adding 'in-fullscreen' class to the body...");
        document.body.classList.add("in-fullscreen");
      } else {
        // If already in fullscreen, exit fullscreen
        console.log("Exiting fullscreen...");

        if (document.exitFullscreen) {
          console.log("Exiting fullscreen using exitFullscreen...");
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          /* Safari */
          console.log("Exiting fullscreen using webkitExitFullscreen...");
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          /* Firefox */
          console.log("Exiting fullscreen using mozCancelFullScreen...");
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          /* IE/Edge */
          console.log("Exiting fullscreen using msExitFullscreen...");
          document.msExitFullscreen();
        }

        // Remove the 'in-fullscreen' class from the body
        console.log("Removing 'in-fullscreen' class from the body...");
        document.body.classList.remove("in-fullscreen");
      }
    }

    var load_tabs = true;
  </script>
  <script src="../assets/script.js"></script>
</body>

<style>
  @keyframes chat-backdrop-open {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes chat-backdrop-close {
    from {
      opacity: 1;
    }

    to {
      opacity: 0;
    }
  }

  .chat-create-backdrop {
    width: 100%;
    height: 100%;
    transition: visibility 0.2s, opacity 0.2s;
    position: fixed;
    top: 0;
    left: 0;
    opacity: 1;
    background: var(--backdrop-light);
    animation: chat-backdrop 0.3s;
  }

  .dark .chat-create-backdrop {
    background: var(--backdrop-dark);
  }

  @keyframes chat-overlay-open {
    from {
      opacity: 0;
      transform: scale(0.9)
    }

    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes chat-overlay-close {
    from {
      opacity: 1;
      transform: scale(1)
    }

    to {
      opacity: 0;
      transform: scale(0.9);
    }
  }

  .custom-chat-window {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 3;
  }

  .custom-chat-window[closed] .chat-create-backdrop {
    animation-name: chat-backdrop-close;
  }

  .chat-overlay {
    animation: chat-overlay-open 0.3s cubic-bezier(1, -0.5, 0.5, 2) 1;
    z-index: 3;
    width: 100%;
    padding: 5px;
    display: flex;
    justify-content: center;
  }

  .custom-chat-window[closed] .chat-overlay {
    animation-name: chat-overlay-close;
  }

  .chat-form {
    text-align: left;
    max-width: 250px;
    width: 100%;
    padding: 10px;
    background: var(--vanilla-velour);
    z-index: 3;
    border-radius: var(--d-1rem);
  }

  .dark .chat-form {
    background: #181818;
  }

  .chat-form input {
    background: var(--cool-platinum);
  }

  .chat-form-container {
    display: flex;
    flex-direction: column;
    gap: 5px;
  }

  .chat-form-container div {
    display: flex;
    flex-direction: column;
  }

  .chat-form-container label {
    display: block;
    font-size: 0.8rem;
    user-select: none;
  }

  #channelName {
    margin-bottom: 5px;
  }

  .tabs-wrapper {
    position: relative;
    overflow: visible;
  }

  .tabs-icon {
    overflow: hidden;
  }

  .custom-chat-del {
    position: absolute;
    right: 0;
    height: 100%;
    width: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .custom-chat-del:active {
    font-size: 0.8rem;
    transition-property: font-size;
    transition-duration: 0.1s;
    transition-timing-function: cubic-bezier(1, -0.5, 0.5, 3);
  }
</style>
